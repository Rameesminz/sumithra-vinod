<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Polster-like EVM - Demo (Photo Column)</title>
<style>
:root{
  --card-bg:#e6f0f8;
  --panel:#ffffff;
  --accent:#0b4b7a; 
  --soft:#dfeef8;
  --muted:#9aa6ad;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  display:flex;align-items:flex-start;justify-content:center;
  background:linear-gradient(180deg,#fafafa, #f2f6fb);
  font-family:Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing:antialiased;
}
.container{width:95%;max-width:760px;padding:24px;margin-top:28px}
.header-pills{display:flex;gap:12px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.pill{padding:8px 18px;border-radius:24px;background:#d7d7d7;color:#444;font-weight:600}
.pill.active{background:#10a0c6;color:white}
.card{background:var(--card-bg);border-radius:22px;padding:16px;box-shadow:0 8px 30px rgba(20,30,40,0.08);}
.card-inner{background:var(--panel);border-radius:14px;padding:12px}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:6px 12px;border-radius:10px}
.status{font-weight:700;color:#0b2b1f}
.status .dot{display:inline-block;width:10px;height:10px;border-radius:50%;background:#2db34a;margin-left:8px}
.title{font-weight:700;color:#0c3b5a}
.table-wrap{overflow-x:auto;margin-top:12px;background:transparent;padding:0;border-radius:8px}
.table{width:100%;border-collapse:collapse}
.table tr{height:60px}
.table td{vertical-align:middle;border-bottom:1px solid rgba(15,25,35,0.06);padding:6px 4px}
.table .idx{width:42px;text-align:center;color:var(--muted)}
.table .name{font-weight:600;text-align:left;padding-left:12px;min-width:80px}
.table .symbol{width:80px;text-align:center}
.symbol img{max-width:50px;height:50px;border-radius:8px;background:white;padding:4px;box-shadow:0 1px 0 rgba(0,0,0,0.06)}
.controls{width:100px;text-align:center;display:flex;justify-content:flex-end;align-items:center;gap:8px}
.vote-btn{width:60px;height:36px;border-radius:18px;background:var(--accent);display:inline-flex;align-items:center;justify-content:center;color:white;font-weight:700;cursor:pointer;box-shadow:inset 0 -3px 0 rgba(0,0,0,0.12)}
.vote-btn:active{transform:translateY(1px)}
.led{width:18px;height:18px;border-radius:50%;background:#5c0b10;box-shadow:inset 0 0 6px rgba(0,0,0,0.35)}
.led.on{background:#b5161a;box-shadow:0 0 8px rgba(181,22,26,0.8), inset 0 0 6px #ffcfcf}
.row-focused{outline:3px solid rgba(11,75,122,0.08);border-radius:8px}
.small-muted{color:var(--muted);font-size:13px;margin-top:8px;text-align:center}

/* Mobile adjustments */
@media (max-width:520px){
  .container{max-width:360px;padding:10px;margin-top:16px}
  .table tr{height:56px}
  .symbol img{max-width:40px;height:40px}
  .vote-btn{width:50px;height:32px;font-size:13px}
  .controls{width:92px;gap:6px}
  .header-pills{gap:8px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header-pills">
    <div class="pill">Ward</div>
    <div class="pill">Block</div>
    <div class="pill active">District</div>
  </div>

  <div class="card">
    <div class="card-inner">
      <div class="topbar">
        <div class="status">Ready <span class="dot" aria-hidden></span></div>
        <div class="title">Ballot Unit 1</div>
      </div>

      <div class="table-wrap">
        <table class="table" role="list" aria-label="candidate-list">
          <tbody id="candidateBody">
            <!-- Rows generated by JS -->
          </tbody>
        </table>
      </div>

      <div class="small-muted">Use mouse or keyboard. Focus a row and press Enter to vote.</div>
    </div>
  </div>
</div>

<audio id="beepSound" preload="auto">
  <source src="https://www.orangefreesounds.com/wp-content/uploads/2022/01/Long-beep-sound.mp3" type="audio/mpeg">
</audio>

<script>
// Candidate data
const defaultCandidates = [
  { id: 1, name: '', symbol: '' },
  { id: 2, name: '', symbol: '' },
  { id: 3, name: 'സൂരജ് എം', symbol: 'images/Hand_INC.jpg' },
  { id: 4, name: '', symbol: '' },
  { id: 5, name: '', symbol: '' },
  { id: 6, name: '', symbol: '' },
  { id: 7, name: '', symbol: '' },
  { id: 8, name: '', symbol: '' },
  { id: 9, name: '', symbol: '' },
  { id: 10, name: '', symbol: '' }
];

const candidateBody = document.getElementById('candidateBody');
let votingLocked = false;

// Query params
function getQueryParams(){
  const p={};
  location.search.replace(/^\?/,'').split('&').forEach(pair=>{
    if(!pair) return;
    const [k,v]=pair.split('='); p[decodeURIComponent(k)]=decodeURIComponent(v||'');
  });
  return p;
}
const params = getQueryParams();

// Path ID
function extractIdFromPath(){
  const parts = location.pathname.split('/').filter(Boolean);
  const idx = parts.findIndex(x=>x.toLowerCase()==='candidate');
  if(idx>=0 && parts.length>idx+1) return parts[idx+1];
  return null;
}
const pathId = extractIdFromPath();

// Build rows
function renderRows(candidates){
  candidateBody.innerHTML='';
  candidates.forEach(c=>{
    const tr = document.createElement('tr');
    tr.tabIndex=0;
    tr.className='candidate-row';
    tr.dataset.num=c.id;

    tr.innerHTML=`
      <td class="idx">${c.id}</td>
      <td class="symbol"><img alt="symbol-${c.id}" src="${c.symbol||''}"></td>
      <td class="name">${c.name||'&nbsp;'}</td>
      <td class="controls">
        <div class="led" id="led${c.id}" aria-hidden></div>
        <div class="vote-btn" role="button" tabindex="-1" data-id="${c.id}">VOTE</div>
      </td>
    `;

    tr.addEventListener('focus',()=>tr.classList.add('row-focused'));
    tr.addEventListener('blur',()=>tr.classList.remove('row-focused'));
    tr.addEventListener('keydown',(ev)=>{
      if(ev.key==='Enter'||ev.key===' '){ev.preventDefault(); tr.querySelector('.vote-btn').click();}
    });

    candidateBody.appendChild(tr);
  });

  document.querySelectorAll('.vote-btn').forEach(btn=>{
    btn.addEventListener('click',()=>castVote(btn,parseInt(btn.dataset.id,10)));
  });
}

// Attach photos from query or path
function attachPhotos(candidates){
  candidates.forEach(c=>{
    const qKey = params['photo'+c.id] || params['photo'];
    if(qKey) c.symbol = qKey;
    else if(pathId) c.symbol = `/v2/evm/candidate/${encodeURIComponent(pathId)}/symbol_${c.id}.jpg`;
  });
}

attachPhotos(defaultCandidates);
renderRows(defaultCandidates);

// Vote function
function castVote(btn,num){
  if(votingLocked) return;
  votingLocked=true;

  document.querySelectorAll('.vote-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.led').forEach(l=>l.classList.remove('on'));

  btn.classList.add('active');
  const led = document.getElementById('led'+num);
  if(led) led.classList.add('on');

  const beep = document.getElementById('beepSound');
  beep.currentTime=0; beep.play().catch(()=>{});

  console.log('voted for',num,'pathId',pathId);

  setTimeout(()=>{
    if(led) led.classList.remove('on');
    btn.classList.remove('active');
    try{beep.pause();beep.currentTime=0}catch(e){}
    votingLocked=false;
  },1200);
}
</script>
</body>
</html>
